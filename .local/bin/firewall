#!/bin/sh

# NOTE: Arch Linux UFW + IPv4-only + AUR helper fixes
# NOTE: Secure defaults + SSH + Browser + Force IPv4

set -e

echo "[+] Installing UFW..."
sudo pacman -S --needed --noconfirm ufw

echo "[+] Enabling UFW service..."
sudo systemctl enable --now ufw

echo "[+] Resetting existing rules..."
sudo ufw --force reset

echo "[+] Setting default policies..."
sudo ufw default deny incoming
sudo ufw default allow outgoing

echo "[+] Allowing SSH (with rate limiting)..."
sudo ufw limit ssh comment 'Allow SSH with rate limit'

# Browsers, AUR helpers, and most applications only need outgoing connections
# No extra incoming ports are opened for them

echo "[+] Enabling IPv6 support in UFW..."
sudo sed -i 's/IPV6=no/IPV6=yes/' /etc/ufw/ufw.conf

echo "[+] Enabling UFW logging..."
sudo ufw logging on

echo "[+] Enabling firewall..."
sudo ufw --force enable

echo "[+] Current firewall status:"
sudo ufw status verbose

echo "[+] Done! Your system is now secured with UFW for both IPv4 and IPv6."
